# --- 1. åŸºç¡€è®¾ç½® ---
port: 7890
socks-port: 7891
mixed-port: 7890 # HTTP/SOCKS5 æ··åˆç«¯å£
allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
mode: rule # è§„åˆ™æ¨¡å¼
log-level: info
ipv6: false
external-controller: 127.0.0.1:9090 # API ç«¯å£
secret: '{{ (bitwarden "item" "mihomo-secret").login.password }}' # API å¯†é’¥ (ç•™ç©ºåˆ™æ— )

# --- 2. DNS é…ç½® (Fake-IP) ---
dns:
  enable: true
  listen: :53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  fallback:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
  nameserver-policy:
    "geosite:cn,private":
      [https://doh.pub/dns-query, https://dns.alidns.com/dns-query]
    "geosite:google,youtube,telegram,gfw":
      [https://1.1.1.1/dns-query, https://8.8.8.8/dns-query]

# --- 3. ä»£ç†æä¾›å•† (Proxy Providers) ---
proxy-providers:
  Airport:
    type: http
    url: '{{ (bitwarden "item" "airport-sub").login.password}}'
    interval: 3600
    path: ./airport.yaml
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204

# --- 4. ç­–ç•¥ç»„ (Proxy Groups) ---
proxy-groups:
  # 4.1 æ ¸å¿ƒé€‰æ‹©ç»„
  - name: ğŸ”° èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - â™»ï¸ æ•…éšœè½¬ç§»
      - ğŸ‡­ğŸ‡° é¦™æ¸¯
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬
      - ğŸ‡ºğŸ‡¸ ç¾å›½
      - DIRECT

  # 4.2 è‡ªåŠ¨æ•…éšœè½¬ç§»
  - name: â™»ï¸ æ•…éšœè½¬ç§»
    type: fallback
    url: http://www.gstatic.com/generate_204
    interval: 300
    use:
      - Airport # ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ Airport æä¾›å•†
    # è¿‡æ»¤æ‰ä¸æƒ³ç”¨çš„èŠ‚ç‚¹
    filter: "(?i)^(?!.*(å®˜ç½‘|å‰©ä½™|åˆ°æœŸ|é‡ç½®|å¥—é¤)).*"

  # 4.3 åœ°åŒºåˆ†ç»„ (åˆ©ç”¨æ­£åˆ™ç­›é€‰)
  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - Airport
    filter: "(?i)HK|Hong|Kong|é¦™æ¸¯" # ğŸ‘ˆ æ­£åˆ™ç­›é€‰é¦™æ¸¯èŠ‚ç‚¹

  - name: ğŸ‡¹ğŸ‡¼ å°æ¹¾
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - Airport
    filter: "(?i)TW|Taiwan|å°æ¹¾|Taipei"

  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - Airport
    filter: "(?i)SG|Singapore|æ–°åŠ å¡|ç‹®åŸ"

  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - Airport
    filter: "(?i)JP|Japan|æ—¥æœ¬|Tokyo"

  - name: ğŸ‡ºğŸ‡¸ ç¾å›½
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - Airport
    filter: "(?i)US|USA|United|States|ç¾å›½"

  # 4.4 ç‰¹æ®ŠåŠŸèƒ½ç»„
  - name: â“‚ï¸ å¾®è½¯æœåŠ¡
    type: select
    proxies:
      - ğŸ”° èŠ‚ç‚¹é€‰æ‹©
      - DIRECT

  - name: ğŸ è‹¹æœæœåŠ¡
    type: select
    proxies:
      - ğŸ”° èŠ‚ç‚¹é€‰æ‹©
      - DIRECT

  - name: ğŸ” é™å®šåŒºåŸŸ (No JP)
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    use:
      - Airport
    # æ’é™¤æ—¥æœ¬å’Œä¸­å›½èŠ‚ç‚¹ (E-Hentai ä¸“ç”¨)
    filter: "(?i)^(?!.*(JP|Japan|æ—¥æœ¬|CN|China)).*"

  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - ğŸ”° èŠ‚ç‚¹é€‰æ‹©
      - DIRECT

# --- 5. è§„åˆ™é›† (Rule Providers) ---
rule-providers:
  reject:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/reject.txt
    interval: 86400
  icloud:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
    path: ./ruleset/icloud.txt
    interval: 86400
  apple:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
    path: ./ruleset/apple.txt
    interval: 86400
  google:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt"
    path: ./ruleset/google.txt
    interval: 86400
  proxy:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.txt
    interval: 86400
  direct:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.txt
    interval: 86400
  private:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./ruleset/private.txt
    interval: 86400
  gfw:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt"
    path: ./ruleset/gfw.txt
    interval: 86400
  tld-not-cn:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt"
    path: ./ruleset/tld-not-cn.txt
    interval: 86400
  telegramcidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: ./ruleset/telegramcidr.txt
    interval: 86400
  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.txt
    interval: 86400
  lan:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./ruleset/lancidr.txt
    interval: 86400
  applications:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./ruleset/applications.txt
    interval: 86400
  microsoft:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/microsoft.txt"
    path: ./ruleset/microsoft.txt
    interval: 86400

# --- 6. è§„åˆ™é“¾ (Rules) ---
rules:
  # 6.1 è‡ªå®šä¹‰ç›´è¿ (ZeroTier ç­‰)
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - DOMAIN-SUFFIX,todesk.com,DIRECT
  - DOMAIN-SUFFIX,baidu.com,DIRECT

  # 6.2 å¾®è½¯/Bing (å¼ºåˆ¶ä»£ç†)
  - DOMAIN-SUFFIX,bing.com,â“‚ï¸ å¾®è½¯æœåŠ¡
  - DOMAIN-SUFFIX,openai.com,â“‚ï¸ å¾®è½¯æœåŠ¡

  # 6.3 E-Hentai (å¼ºåˆ¶é¿å¼€æ—¥æœ¬)
  - DOMAIN-SUFFIX,exhentai.org,ğŸ” é™å®šåŒºåŸŸ (No JP)
  - DOMAIN-SUFFIX,e-hentai.org,ğŸ” é™å®šåŒºåŸŸ (No JP)

  # 6.4 åŸºç¡€è§„åˆ™é›† (ç™½åå•æ¨¡å¼)
  - RULE-SET,applications,DIRECT
  - RULE-SET,private,DIRECT
  - RULE-SET,reject,REJECT
  - RULE-SET,icloud,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,apple,ğŸ è‹¹æœæœåŠ¡
  - RULE-SET,google,ğŸ”° èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,telegramcidr,ğŸ”° èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,gfw,ğŸ”° èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,proxy,ğŸ”° èŠ‚ç‚¹é€‰æ‹©
  - RULE-SET,tld-not-cn,ğŸ”° èŠ‚ç‚¹é€‰æ‹©
  # - RULE-SET,microsoft,â“‚ï¸ å¾®è½¯æœåŠ¡
  - RULE-SET,direct,DIRECT
  - RULE-SET,cncidr,DIRECT
  - GEOIP,CN,DIRECT

  # 6.5 æ¼ç½‘ä¹‹é±¼
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
